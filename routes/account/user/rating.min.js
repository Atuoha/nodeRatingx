'use strict';const express=require("express"),app=express(),router=express.Router(),Company=require("../../../models/Company"),User=require("../../../models/User"),Rating=require("../../../models/Rating");router.all("/*",(b,d,a)=>{b.app.locals.layout="user";a()});router.get("/",(b,d)=>{Company.find().then(a=>{d.render("accounts/user/company/subscribers_company_views",{title:"User|Company",companies:a})}).catch(a=>console.log(a))});
router.get("/create/:id",(b,d)=>{Company.findOne({_id:b.params.id}).then(a=>{d.render("accounts/user/rating/create",{title:"Rating|Company",company:a})}).catch(a=>console.log(a))});
router.post("/create/:id",(b,d)=>{const a=new Rating;a.rating=b.body.rating;a.review=b.body.review;a.company=b.body.company;a.user=b.user;a.save().then(e=>{Company.findOne({_id:b.params.id}).then(c=>{c.ratingSum+=parseInt(b.body.rating);c.ratingNumber+=1;c.save().then(f=>{d.redirect(`/user/company/show/${b.body.company}`)}).catch(f=>console.log(f))}).catch(c=>console.log(c))}).catch(e=>console.log(e))});module.exports=router;