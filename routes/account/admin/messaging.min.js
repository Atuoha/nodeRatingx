'use strict';const express=require("express"),app=express(),router=express.Router(),User=require("../../../models/User"),Messaging=require("../../../models/Messaging"),{adminAuth}=require("../../../helpers/authenticate");router.all("/*",adminAuth,(a,c,b)=>{a.app.locals.layout="messaging";b()});router.get("/",(a,c)=>{c.redirect("/user")});
router.get("/:id",(a,c)=>{User.findOne({_id:a.params.id}).then(b=>{Messaging.find({sender:a.user}).populate("sender").populate("receiver").then(d=>{Messaging.find({sender:a.params.id}).populate("sender").populate("receiver").then(e=>{c.render("accounts/user/messaging",{title:"Messaging",user:b,logged_chats:d,receiver_chats:e})}).catch(e=>console.log(e))}).catch(d=>console.log(d))}).catch(b=>console.log(b))});
router.post("/create",(a,c)=>{const b=new Messaging;b.sender=a.body.sender;b.receiver=a.body.receiver;b.msg=a.body.msg;b.save().then(d=>{c.redirect("back")}).catch(d=>console.log(d))});module.exports=router;